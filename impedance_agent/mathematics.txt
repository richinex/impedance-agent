# Mathematical Analysis of Lack of Fit in Nyquist Plot

To mathematically capture the lack of fit in the Nyquist plot, we analyze the discrepancies between the experimental data and the model predictions using several quantitative metrics.

## 1. Residual Analysis

Residuals provide a direct measure of the fit quality. For impedance data, we analyze both the real and imaginary parts of the residuals.

### Normalized Residuals
\[
\text{Residuals}_{\text{real}} = \frac{Z_{\text{fit, real}} - Z_{\text{exp, real}}}{|Z_{\text{exp}}|}
\]
\[
\text{Residuals}_{\text{imag}} = \frac{Z_{\text{fit, imag}} - Z_{\text{exp, imag}}}{|Z_{\text{exp}}|}
\]
where \( |Z_{\text{exp}}| = \sqrt{Z_{\text{exp, real}}^2 + Z_{\text{exp, imag}}^2} \).

### Mean and Maximum Residuals
\[
\text{Mean Residual} = \frac{1}{N} \sum_{i=1}^{N} \left( \frac{|Z_{\text{fit, i}} - Z_{\text{exp, i}}|}{|Z_{\text{exp, i}}|} \right)
\]
\[
\text{Max Residual} = \max \left( \frac{|Z_{\text{fit, i}} - Z_{\text{exp, i}}|}{|Z_{\text{exp, i}}|} \right)
\]

## 2. Chi-Square Statistic

The chi-square statistic measures the goodness of fit by summing the squared differences between observed and predicted values, weighted by the error in the observations.
\[
\chi^2 = \sum_{i=1}^{N} \left( \frac{(Z_{\text{fit, real, i}} - Z_{\text{exp, real, i}})^2}{\sigma_{\text{real, i}}^2} + \frac{(Z_{\text{fit, imag, i}} - Z_{\text{exp, imag, i}})^2}{\sigma_{\text{imag, i}}^2} \right)
\]
where \( \sigma_{\text{real, i}} \) and \( \sigma_{\text{imag, i}} \) are the standard deviations of the real and imaginary parts of the impedance, respectively.

## 3. Akaike Information Criterion (AIC)

AIC provides a measure of the relative quality of a statistical model, balancing the goodness of fit with the complexity of the model.
\[
\text{AIC} = 2k - 2\ln(L)
\]
where \( k \) is the number of parameters in the model, and \( L \) is the likelihood function. For impedance fitting, this can be approximated using the chi-square statistic:
\[
\text{AIC} = 2k + \chi^2
\]

## 4. Vector Difference and Path Following Metrics

### Vector Difference
Measures the overall magnitude and direction mismatch at each frequency.
\[
\text{Vector Difference} = \frac{1}{N} \sum_{i=1}^{N} \left( \frac{|Z_{\text{fit, i}} - Z_{\text{exp, i}}|}{|Z_{\text{exp, i}}|} \right)
\]

### Path Deviation
Measures how well the fit follows the data trajectory.
\[
\text{Path Deviation} = \frac{1}{N-1} \sum_{i=1}^{N-1} \left| \frac{\Delta Z_{\text{fit, i}}}{|\Delta Z_{\text{fit, i}}|} - \frac{\Delta Z_{\text{exp, i}}}{|\Delta Z_{\text{exp, i}}|} \right|
\]
where \( \Delta Z_{\text{fit, i}} = Z_{\text{fit, i+1}} - Z_{\text{fit, i}} \) and \( \Delta Z_{\text{exp, i}} = Z_{\text{exp, i+1}} - Z_{\text{exp, i}} \).

## 5. Regularization in DRT

For DRT analysis, regularization is used to prevent overfitting. The regularization parameter \( \lambda \) balances the fit quality and the smoothness of the DRT.
\[
\text{Objective Function} = \|Z_{\text{exp}} - Z_{\text{fit}}\|^2 + \lambda \|L \gamma\|^2
\]
where \( L \) is a matrix representing the regularization operator, and \( \gamma \) is the distribution of relaxation times.

## 6. Cross-Method Validation

Compare the residuals and fit quality metrics across different methods (Lin-KK, DRT, ECM) to identify systematic discrepancies.
\[
\text{Cross-Method Residual} = \frac{1}{N} \sum_{i=1}^{N} \left( \frac{|Z_{\text{method1, i}} - Z_{\text{method2, i}}|}{|Z_{\text{exp, i}}|} \right)
\]

## 7. Final Recommendations

- **For Poor Vector Difference**: Adjust parameter bounds, verify model structure, and consider additional elements.
- **For Poor Path Following**: Add elements for missing features, modify model structure, and review frequency ranges.

By mathematically analyzing the residuals and fit quality metrics, we can systematically identify and address the lack of fit in the Nyquist plot. This approach ensures that the model accurately captures the underlying physical processes and provides actionable insights for model refinement.